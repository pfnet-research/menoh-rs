language: rust
os:
  - linux
  - osx
rust:
  - stable
  - nightly
cache: cargo
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - sourceline: 'ppa:maarten-fonville/protobuf'
install:
  - |
    if [[ $TRAVIS_OS_NAME == 'linux' ]]; then
        curl -LO https://github.com/pfnet-research/menoh/releases/download/v1.0.3/ubuntu1404_mkl-dnn_0.16-1_amd64.deb
        curl -LO https://github.com/pfnet-research/menoh/releases/download/v1.0.3/ubuntu1404_menoh_1.0.3-1_amd64.deb
        curl -LO https://github.com/pfnet-research/menoh/releases/download/v1.0.3/ubuntu1404_menoh-dev_1.0.3-1_amd64.deb
        sudo dpkg -i *.deb
    fi
  - |
    if [[ $TRAVIS_OS_NAME == 'osx' ]]; then
        brew tap pfnet-research/menoh
        brew install menoh
    fi
before_script:
  - |
    cd $TRAVIS_BUILD_DIR
    export LD_LIBRARY_PATH=$HOME/.local/lib
    export PKG_CONFIG_PATH=$HOME/.local/share/pkgconfig
  - curl -L https://github.com/pfnet-research/menoh-rs/releases/download/assets/MLP.onnx -o menoh/MLP.onnx
